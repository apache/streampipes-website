"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[86603],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>h});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},d=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=p(a),u=r,h=c["".concat(s,".").concat(u)]||c[u]||m[u]||i;return a?n.createElement(h,o(o({ref:t},d),{},{components:a})):n.createElement(h,o({ref:t},d))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[c]="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},56767:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>p,toc:()=>c});var n=a(87462),r=a(63366),i=(a(67294),a(3905)),o=["components"],l={id:"use-programmatically-create-adapters",title:"Adapters as Code",sidebar_label:"Adapters as Code"},s=void 0,p={unversionedId:"use-programmatically-create-adapters",id:"version-0.97.0/use-programmatically-create-adapters",title:"Adapters as Code",description:"In Apache StreamPipes, adapters are typically created via the web interface.",source:"@site/versioned_docs/version-0.97.0/03_use-programmatically-create-adapters.md",sourceDirName:".",slug:"/use-programmatically-create-adapters",permalink:"/docs/use-programmatically-create-adapters",draft:!1,tags:[],version:"0.97.0",lastUpdatedBy:"Philipp Zehnder",lastUpdatedAt:1739799205,formattedLastUpdatedAt:"Feb 17, 2025",sidebarPosition:3,frontMatter:{id:"use-programmatically-create-adapters",title:"Adapters as Code",sidebar_label:"Adapters as Code"},sidebar:"documentation",previous:{title:"Configurations",permalink:"/docs/use-configurations"},next:{title:"Pipelines as Code",permalink:"/docs/use-programmatically-create-pipelines"}},d={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Adapter YAML Structure",id:"adapter-yaml-structure",level:2},{value:"Programmatically creating adapters",id:"programmatically-creating-adapters",level:2},{value:"Background: Internal adapter generation process",id:"background-internal-adapter-generation-process",level:3},{value:"Getting a valid definition file",id:"getting-a-valid-definition-file",level:3},{value:"Configuration",id:"configuration",level:4},{value:"Schema",id:"schema",level:4},{value:"Enrich",id:"enrich",level:4},{value:"Transform",id:"transform",level:4},{value:"CreateOptions",id:"createoptions",level:4},{value:"API",id:"api",level:3}],m={toc:c},u="wrapper";function h(e){var t=e.components,a=(0,r.Z)(e,o);return(0,i.kt)(u,(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"In Apache StreamPipes, adapters are typically created via the web interface.\nHowever, it is possible to create adapters programmatically using a compact YAML format and the StreamPipes REST API.\nProgrammatic creation of adapters can be a useful feature in cases where many similar adapters have to be created.\nIn this case, an externally managed YAMl file containing the full adapter configuration can be used and modified."),(0,i.kt)("h2",{id:"introduction"},"Introduction"),(0,i.kt)("p",null,"In StreamPipes, adapters are responsible for collecting data from various industrial data sources.\nWhile the UI simplifies this process, you can also manage adapters programmatically for better automation, integration with CI/CD pipelines, or infrastructure-as-code practices."),(0,i.kt)("p",null,"This guide demonstrates how to define and create adapters using a YAML format and StreamPipes REST API, offering more flexibility to manage adapters programmatically."),(0,i.kt)("h2",{id:"adapter-yaml-structure"},"Adapter YAML Structure"),(0,i.kt)("p",null,"An adapter in StreamPipes can be defined using a YAML file, which contains a compact description of the adapter configuration.\nThe basic structure of the YAML format for an adapter definition includes:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Name"),": The name of the adapter."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"ID"),": A unique ID for the adapter"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Description"),": An additional description of the adapter"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"AppID"),": The adapter type"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Configuration"),": Configuration details such as connection details, polling intervals, data format, and more"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Schema"),": Schema refinements, e.g., additional label, description, semantic type and property scope"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Enrich"),": Enrichment rules. Currently, only timestamp enrichment rules are supported in the YAML specification"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Transform"),": Transformation rules. Currently, rename and measurement unit transforms are supported."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"CreateOptions"),": Additional operations that are executed upon adapter generation.")),(0,i.kt)("p",null,"Here\u2019s a sample structure to define an OPC-UA adapter:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'name: My OPC Adapter\nid: testadapter\ndescription: Test\nappId: org.apache.streampipes.connect.iiot.adapters.opcua\nconfiguration:\n  - opc_host_or_url: OPC_URL\n    opc_server_url: opc.tcp://localhost:62541/milo\n  - adapter_type: PULL_MODE\n    pulling_interval: 1000\n  - access_mode: UNAUTHENTICATED\n  - available_nodes:\n    - "ns=2;s=Leakage Test Station/temperature"\n    - "ns=2;s=Leakage Test Station/pressure"\n\nschema:\n  temperature:\n    propertyScope: measurement\n    label: Temp\n    description: Temperature value\n    semanticType: http://schema.org/temperature\n\nenrich:\n  timestamp: timestamp\n\ntransform:\n  rename:\n    pressure: pressure3\n\ncreateOptions:\n  persist: true\n  start: true\n')),(0,i.kt)("h2",{id:"programmatically-creating-adapters"},"Programmatically creating adapters"),(0,i.kt)("p",null,"Here is a walkthrough to create an adapter programmatically over the API:"),(0,i.kt)("h3",{id:"background-internal-adapter-generation-process"},"Background: Internal adapter generation process"),(0,i.kt)("p",null,"The YAML definition file is a more compact notation of StreamPipes internal data format to represent an adapter.\nWhen creating an adapter over the user interface, StreamPipes requires some basic, adapter-specific settings.\nAfterwards, a ",(0,i.kt)("inlineCode",{parentName:"p"},"Guess Schema")," step is executed. In this step, StreamPipes connects to the underlying data sources, receives some samples of live data, determines the exact schema of the data stream and provides user with the source schema.\nThis schema can be further refined using ",(0,i.kt)("inlineCode",{parentName:"p"},"Transformation Rules"),". "),(0,i.kt)("p",null,"When an adapter is created using the more compact YAML notation, the same process is applied. Based on the provided configuration, the API connects to the given data source and determines the schema.\nThe transformation rules provided in the YAMl definition are then applied on the original schema.\nTherefore, it is important that the provided schema refinement and transformation steps fit the original schema."),(0,i.kt)("h3",{id:"getting-a-valid-definition-file"},"Getting a valid definition file"),(0,i.kt)("p",null,"The easiest way to create a valid YAML file is the user interface. Within the StreamPipes Connect view, it is possible to export the YAML definition for all existing adapters.\nIn addition, the adapter generation wizard also offers the option to view the adapter configuration before creating the adapter by clicking the ",(0,i.kt)("inlineCode",{parentName:"p"},"Code")," checkbox:"),(0,i.kt)("img",{className:"docs-image",src:"/img/03_use-programmatically-create-adapters/01_adapter-generation-code.png",alt:"StreamPipes Adapter Code View"}),(0,i.kt)("p",null,"Another option is to open the adapter details view:"),(0,i.kt)("img",{className:"docs-image",src:"/img/03_use-programmatically-create-adapters/02_adapter-details-view-code.png",alt:"StreamPipes Adapter Details Code View"}),(0,i.kt)("p",null,"You can copy this definition and modify it according to your needs."),(0,i.kt)("h4",{id:"configuration"},"Configuration"),(0,i.kt)("p",null,"For each configuration option in the user interface, there is a mapping to the YAMl definition."),(0,i.kt)("p",null,"A configuration value is a key/value pair, where the key corresponds to the internal name of the configuration and the value depends on the configuration type."),(0,i.kt)("h4",{id:"schema"},"Schema"),(0,i.kt)("p",null,"Schema definitions enhance the metadata of each field from the input stream.\nThe following configurations are supported:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"label")," to add an additional (human-readable) label to the field"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"description")," for an additional description"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"propertyScope")," to determine the type of the field (HEADER_PROPERTY, DIMENSION_PROPERTY or MEASUREMENT_PROPERTY)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"semanticType")," to provide the semantic type of the field (e.g., ",(0,i.kt)("inlineCode",{parentName:"li"},"https://schema.org/temperature"),")")),(0,i.kt)("h4",{id:"enrich"},"Enrich"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"timestamp")," defines that an additional field named timestamp is added to each incoming event containing the ingestion time as a UNIX timestamp.")),(0,i.kt)("h4",{id:"transform"},"Transform"),(0,i.kt)("p",null,"Currently, the following transforms are supported:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"rename")," defines renaming of individual fields from the input stream. A valid configuration consists of a key/value pair, where the key indicates the original field name and the value the target field name."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"measurementUnit")," defines a value transformation between measurement units. A valid configuration consists of a key/value pair, where the key indicates the field name and the value the target measurement unit.")),(0,i.kt)("h4",{id:"createoptions"},"CreateOptions"),(0,i.kt)("p",null,"Currently, two settings can be provided in the ",(0,i.kt)("inlineCode",{parentName:"p"},"CreateOptions")," section:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"persist")," indicates whether the data stream produced by the adapter should also be stored. In this case, a ",(0,i.kt)("inlineCode",{parentName:"li"},"Persist Pipeline")," is automatically created."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"start")," indicates whether the adapter should be immediately started after creation.")),(0,i.kt)("h3",{id:"api"},"API"),(0,i.kt)("p",null,"To create a new adapter, call the StreamPipes API as follows:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"POST /streampipes-backend/api/v2/connect/compact-adapters\nContent-type: application/yml\nAccept: application/yml\n")),(0,i.kt)("p",null,"You must provide valid credentials by either adding a Bearer token or an API key:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"X-API-USER: your username\nX-API-KEY: your api key\n")),(0,i.kt)("p",null,"The body of the request should contain the YAML definition."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"It is also possible to provide the adapter specification as a JSON document. In this case, change the ",(0,i.kt)("inlineCode",{parentName:"p"},"Content-type")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"application/json"),".")))}h.isMDXComponent=!0}}]);