"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[92521],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>f});var i=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=i.createContext({}),l=function(e){var t=i.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=l(e.components);return i.createElement(p.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},u=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,p=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),d=l(n),u=a,f=d["".concat(p,".").concat(u)]||d[u]||m[u]||r;return n?i.createElement(f,s(s({ref:t},c),{},{components:n})):i.createElement(f,s({ref:t},c))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,s=new Array(r);s[0]=u;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o[d]="string"==typeof e?e:a,s[1]=o;for(var l=2;l<r;l++)s[l]=n[l];return i.createElement.apply(null,s)}return i.createElement.apply(null,n)}u.displayName="MDXCreateElement"},44982:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>p,default:()=>f,frontMatter:()=>o,metadata:()=>l,toc:()=>d});var i=n(87462),a=n(63366),r=(n(67294),n(3905)),s=["components"],o={id:"use-programmatically-create-pipelines",title:"Pipelines as Code",sidebar_label:"Pipelines as Code"},p=void 0,l={unversionedId:"use-programmatically-create-pipelines",id:"version-0.97.0/use-programmatically-create-pipelines",title:"Pipelines as Code",description:"In Apache StreamPipes, pipelines represent the flow of data from sources (streams), through processors (filters, transformations, etc.), and finally to sinks (third-party-systems, storage, notifications).",source:"@site/versioned_docs/version-0.97.0/03_use-programmatically-create-pipelines.md",sourceDirName:".",slug:"/use-programmatically-create-pipelines",permalink:"/docs/use-programmatically-create-pipelines",draft:!1,tags:[],version:"0.97.0",lastUpdatedBy:"Philipp Zehnder",lastUpdatedAt:1739799205,formattedLastUpdatedAt:"Feb 17, 2025",sidebarPosition:3,frontMatter:{id:"use-programmatically-create-pipelines",title:"Pipelines as Code",sidebar_label:"Pipelines as Code"},sidebar:"documentation",previous:{title:"Adapters as Code",permalink:"/docs/use-programmatically-create-adapters"},next:{title:"Allen Bradley ETH",permalink:"/docs/pe/org.apache.streampipes.connect.iiot.adapters.plc4x.generic.ab-eth"}},c={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Pipeline YAML Structure",id:"pipeline-yaml-structure",level:2},{value:"Pipeline Elements",id:"pipeline-elements",level:2},{value:"Building blocks",id:"building-blocks",level:3},{value:"Stream",id:"stream",level:4},{value:"Processor",id:"processor",level:4},{value:"Sink",id:"sink",level:4},{value:"Configuration",id:"configuration",level:3},{value:"Example pipeline as Code",id:"example-pipeline-as-code",level:2},{value:"API",id:"api",level:2}],m={toc:d},u="wrapper";function f(e){var t=e.components,n=(0,a.Z)(e,s);return(0,r.kt)(u,(0,i.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"In Apache StreamPipes, pipelines represent the flow of data from sources (streams), through processors (filters, transformations, etc.), and finally to sinks (third-party-systems, storage, notifications).\nTraditionally, pipelines are created through the web-based user interface.\nHowever, they can also be defined programmatically as code, offering the flexibility to manage pipelines using Infrastructure as Code (IaC) practices."),(0,r.kt)("p",null,"This guide explains how to define and create pipelines programmatically using a YAML structure."),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"Defining pipelines as code allows you to automate the creation, management, and deployment of StreamPipes pipelines.\nThis is especially useful for managing multiple StreamPipes instances across environments.\nPipelines are written in a YAML format (or alternatively as JSON) and can be deployed programmatically via the StreamPipes REST API."),(0,r.kt)("p",null,"This guide provides an overview of how to structure pipeline definitions in YAML and deploy them using the API."),(0,r.kt)("h2",{id:"pipeline-yaml-structure"},"Pipeline YAML Structure"),(0,r.kt)("p",null,"A pipeline in YAML consists of several key sections:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"ID"),": A unique identifier for the pipeline."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Name and Description"),": Optional fields to describe the pipeline."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Pipeline Elements"),": The components that make up the pipeline, including streams (data sources), processors (data transformations), and sinks (output destinations)."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Create Options"),": Specifies how and when to start the pipeline (e.g., ",(0,r.kt)("inlineCode",{parentName:"li"},"start: false")," means the pipeline won't start automatically).")),(0,r.kt)("p",null,"Here\u2019s a high-level breakdown of the structure:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'id: my-pipeline\nname: ""\ndescription: ""\npipelineElements:  # Define pipeline components here\n  - type: stream     # Data source\n    ref: <reference> # Unique reference ID\n    id: <data-stream-id> # ID of the stream\n\n  - type: processor  # Data transformation\n    ref: <reference> # Unique reference ID\n    id: <processor-id> # ID of the processor\n    connectedTo:     # Previous pipeline element reference(s)\n      - <reference>\n    configuration:   # Processor-specific configurations\n      - <configuration-option>\n\n  - type: sink       # Data sink (output)\n    ref: <reference> # Unique reference ID\n    id: <sink-id>    # ID of the sink\n    connectedTo:     # Previous pipeline element reference(s)\n      - <reference>\n    configuration:   # Sink-specific configurations\n      - <configuration-option>\n\ncreateOptions:\n  start: <true|false>  # Whether to start the pipeline immediately\n')),(0,r.kt)("h2",{id:"pipeline-elements"},"Pipeline Elements"),(0,r.kt)("h3",{id:"building-blocks"},"Building blocks"),(0,r.kt)("p",null,"The key building blocks of a pipeline include:"),(0,r.kt)("h4",{id:"stream"},"Stream"),(0,r.kt)("p",null,"A stream represents a data source in the pipeline, such as a sensor feed, API, or message queue. It is referenced by a unique ID that identifies the data stream."),(0,r.kt)("h4",{id:"processor"},"Processor"),(0,r.kt)("p",null,"A processor transforms, filters, or enriches the data coming from a stream or another processor. Each processor has configuration parameters that control its behavior, such as filtering criteria or mapping options."),(0,r.kt)("h4",{id:"sink"},"Sink"),(0,r.kt)("p",null,"A sink sends the processed data to a final destination, such as a database, file storage, or another service. Sinks may also have configuration options that specify where and how the data should be sent."),(0,r.kt)("p",null,"A pipeline element is selected by providing its ID. For processors and sinks, the ID  refers to the ",(0,r.kt)("inlineCode",{parentName:"p"},"appId")," of the pipeline element, e.g., ",(0,r.kt)("inlineCode",{parentName:"p"},"org.apache.streampipes.processors.filters.jvm.numericalfilter"),".\nFor data streams, the ID refers to the ",(0,r.kt)("inlineCode",{parentName:"p"},"elementId")," of the data stream."),(0,r.kt)("p",null,"To define connections between pipeline elements, the ",(0,r.kt)("inlineCode",{parentName:"p"},"ref")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"connectedTo")," fields can be used.\n",(0,r.kt)("inlineCode",{parentName:"p"},"ref")," can be a short string (e.g., ",(0,r.kt)("inlineCode",{parentName:"p"},"stream01")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"processor01"),") which will be used as an internal identifier of the pipeline element.\nWithin the ",(0,r.kt)("inlineCode",{parentName:"p"},"connectedTo")," list, connections to other pipeline elements can be defined.\nEach item of the list should relate to an existing ",(0,r.kt)("inlineCode",{parentName:"p"},"ref"),"."),(0,r.kt)("h3",{id:"configuration"},"Configuration"),(0,r.kt)("p",null,"In the ",(0,r.kt)("inlineCode",{parentName:"p"},"configuration")," section, which only applies for data processors and sinks, the pipeline element configuration can be applied.\nThe configuration options depend on the pipeline element and have the same structure as the adapter configuration (see ",(0,r.kt)("a",{parentName:"p",href:"use-programmatically-create-adapters"},"Adapters as Code"),")\nThe easiest way to determine a valid configuration is the web interface."),(0,r.kt)("p",null,"After creating a pipeline in the web interface and clicking on ",(0,r.kt)("inlineCode",{parentName:"p"},"Save pipeline"),", the option ",(0,r.kt)("inlineCode",{parentName:"p"},"Show pipeline configuration as code")," shows the current pipeline configuration in YAML or JSON format:"),(0,r.kt)("img",{className:"docs-image",src:"/img/03_use-programmatically-create-pipelines/01_pipeline-editor-pipeline-as-code.png",alt:"StreamPipes Pipeline Editor Code View"}),(0,r.kt)("p",null,"Another option is to view the pipeline details for an existing pipeline. Here, the YAMl definition of the pipeline can be viewed by clicking the ",(0,r.kt)("inlineCode",{parentName:"p"},"View pipeline as code")," button:"),(0,r.kt)("img",{className:"docs-image",src:"/img/03_use-programmatically-create-pipelines/02_pipeline-details-pipeline-as-code.png",alt:"StreamPipes Pipeline Editor Code View"}),(0,r.kt)("h2",{id:"example-pipeline-as-code"},"Example pipeline as Code"),(0,r.kt)("p",null,"Here's an example of a pipeline written in YAML format:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'id: my-pipeline\nname: "Density Filter Pipeline"\ndescription: "A pipeline that filters data based on the density and stores it in a data lake."\npipelineElements:\n  - type: stream\n    ref: stream01\n    id: sp:spdatastream:GWWzMD\n  - type: processor\n    ref: processor01\n    id: org.apache.streampipes.processors.filters.jvm.numericalfilter\n    connectedTo:\n      - stream01\n    configuration:\n      - number-mapping: s0::density\n      - operation: <\n      - value: "12"\n  - type: sink\n    ref: sink01\n    id: org.apache.streampipes.sinks.internal.jvm.datalake\n    connectedTo:\n      - processor01\n    configuration:\n      - timestamp_mapping: s0::timestamp\n      - db_measurement: my-measurement\n      - schema_update: Update schema\n      - dimensions_selection:\n          - sensorId\n      - ignore_duplicates: false\ncreateOptions:\n  start: false\n')),(0,r.kt)("p",null,"Stream: The pipeline begins with a data stream (sp:spdatastream:GWWzMD) referenced by stream01. This is the source of the data."),(0,r.kt)("p",null,"Processor: The data is passed through a numerical filter processor (org.apache.streampipes.processors.filters.jvm.numericalfilter) which checks if the field s0::density is less than 12. The filter is connected to the stream via reference stream01."),(0,r.kt)("p",null,"Sink: The filtered data is then sent to a data lake (org.apache.streampipes.sinks.internal.jvm.datalake). The sink is configured with several parameters including the mapping of the timestamp (s0::timestamp) and schema update options. The sink is connected to the processor via reference processor01."),(0,r.kt)("p",null,"Create Options: The pipeline is set to not start automatically (start: false)."),(0,r.kt)("h2",{id:"api"},"API"),(0,r.kt)("p",null,"To create a new pipeline, call the StreamPipes API as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"POST /streampipes-backend/api/v2/compact-pipelines\nContent-type: application/yml\nAccept: application/yml\n")),(0,r.kt)("p",null,"You must provide valid credentials by either adding a Bearer token or an API key:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"X-API-USER: your username\nX-API-KEY: your api key\n")),(0,r.kt)("p",null,"The body of the request should contain the YAML definition."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"It is also possible to provide the pipeline specification as a JSON document. In this case, change the ",(0,r.kt)("inlineCode",{parentName:"p"},"Content-type")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"application/json"),".")))}f.isMDXComponent=!0}}]);